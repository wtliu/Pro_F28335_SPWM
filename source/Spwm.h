//==========================================================================================================
//                                          正弦表功能定义
//==========================================================================================================
#define F 150000000			//ADC模块时钟 = HSPCLK(高速外设时钟)/ADC_CKPS*2   = 30MHz/(1*2) = 15MHz = 150000000

//正弦表，半波是64个点，及相关参数
//双极性正弦波使用的正弦查表
float32 Sine1[128]={
0.000000,0.049068,0.098017,0.146730,0.195090,0.242980,0.290285,0.336890,0.382683,0.427555,0.471397,0.514103,0.555570,0.595699,0.634393,0.671559,
0.707107,0.740951,0.773010,0.803208,0.831470,0.857729,0.881921,0.903989,0.923880,0.941544,0.956940,0.970031,0.980785,0.989177,0.995185,0.998795,
1.000000,0.998795,0.995185,0.989177,0.980785,0.970031,0.956940,0.941544,0.923880,0.903989,0.881921,0.857729,0.831470,0.803208,0.773010,0.740951,
0.707107,0.671559,0.634393,0.595699,0.555570,0.514103,0.471397,0.427555,0.382683,0.336890,0.290285,0.242980,0.195090,0.146731,0.098017,0.049068,

 0.000000,-0.049068,-0.098017,-0.146730,-0.195090,-0.242980,-0.290285,-0.336890,-0.382683,-0.427555,-0.471397,-0.514103,-0.555570,-0.595699,-0.634393,-0.671559,
-0.707107,-0.740951,-0.773010,-0.803208,-0.831470,-0.857729,-0.881921,-0.903989,-0.923880,-0.941544,-0.956940,-0.970031,-0.980785,-0.989177,-0.995185,-0.998795,
-1.000000,-0.998795,-0.995185,-0.989177,-0.980785,-0.970031,-0.956940,-0.941544,-0.923880,-0.903989,-0.881921,-0.857729,-0.831470,-0.803208,-0.773010,-0.740951,
-0.707107,-0.671559,-0.634393,-0.595699,-0.555570,-0.514103,-0.471397,-0.427555,-0.382684,-0.336890,-0.290285,-0.242980,-0.195090,-0.146731,-0.098017,-0.049068 
};

Uint16 CompVal[128], CarrVal;

float32 M,N;		//调制比,载波比
float32 N_temp;
float32 T,fs;

float32 PWMHz;		//驱动频率
Uint16 SPWMCntA,SinCntA;
Uint16 SPWMCntB,SinCntB;
Uint16 SPWMCntC,SinCntC;
Uint16 phaseV=0;

//SPWMCntA相位值计算方法如下(N=400)：
//SPWMCntA = 000;		000° SPWMCntA=000°/360°*N=0
//SPWMCntB = 133; 		120° SPWMCntB=120°/360°*N=0.333*400=133
//SPWMCntC = 266;		240° SPWMCntC=240°/360°*N=0.666*400=266
//相位值:Phase=SPWMCntX/N*360°

//N=200 fs=50时T=0.00010;CarrVal=150000000*0.00010=15000;CarrVal>>1 CarrVal=11101010011000>>1 =1110101001100=7500 10KHz

void Calc_Spwm(void)
{
	Uint16 k;

    T=1/(fs*N);

    CarrVal=(Uint16)(F*T);
	CarrVal=CarrVal>>1;
    
    for(k=0;k<128;k++)
    {
   		//双极性SPWM正弦波使用的占空比计算数据，配合反向输出互补的PWM设置
		CompVal[k]=(Uint16)((Sine1[k]*M+1)/2.0*CarrVal);	

   		//单极性SPWM正弦波20kHz使用的占空比计算数据，用于100Hz正弦推挽并网、50Hz单极性正弦并网或方波交流，配合输出正独立的或正输出互补PWM设置都可以
		//CompVal[k]=(Uint16)((Sine2[k]*M)*CarrVal);
   	}
} 
//==========================================================================================================
//                                          正弦表功能定义 END
//==========================================================================================================
